<% content_for :title, finder.name %>
<% content_for :head do %>
  <%= auto_discovery_link_tag(:atom, @results.atom_url) %>
  <%= render 'finder_meta', finder: finder %>
<% end %>

<% if finder.show_phase_banner? %>
  <%= render 'govuk_publishing_components/components/phase_banner', phase: finder.phase, message: finder.phase_message%>
<% end %>

<% if @breadcrumbs.breadcrumbs %>
  <%= render 'govuk_publishing_components/components/breadcrumbs', breadcrumbs: @breadcrumbs.breadcrumbs %>
<% else %>
  <%= render 'govuk_publishing_components/components/contextual_breadcrumbs', content_item: @content_item %>
<% end %>

<% if finder.government? %>
  <%= render 'govuk_publishing_components/components/government_navigation', active: finder.government_content_section %>
<% end %>

<header>
  <div class="title-and-metadata">
    <%= render partial: 'govuk_publishing_components/components/title', locals: {
      context: finder.human_readable_finder_format,
      title: finder.name
    } %>
    <% if finder.page_metadata.any? %>
      <%= render 'govuk_publishing_components/components/metadata', page_metadata(finder.page_metadata) %>
    <% end %>

    <% if finder.summary %>
      <div class="summary">
        <%= render 'govuk_publishing_components/components/govspeak', content: finder.summary.html_safe %>
      </div>
    <% end %>

    <% if finder.email_alert_signup_url %>
      <p class='email-link'>
        <%= link_to "Subscribe to email alerts", finder.email_alert_signup_url %>
      </p>
    <% end %>
  </div>

  <% if finder.logo_path %>
    <div class="logo">
      <%= image_tag finder.logo_path, id: "logo-image" %>
    </div>
  <% end %>

  <% if finder.related.any? %>
    <div class='related-links'>
      <ul>
        <% finder.related.each do |link| %>
          <li><%= link_to link['title'], link['web_url'] %></li>
        <% end %>
      </ul>
    </div>
  <% end %>
</header>

<div class="filtering">
  <%= render finder.facets %>
  <div class='js-live-search-results-block'>
    <div class="filtered-results">
      <div aria-live='assertive' id='js-search-results-info'>
        <% if finder.show_generic_description? %>
          <%= render_mustache('result_count_generic', @results.to_hash) %>
        <% else %>
          <%= render_mustache('result_count', @results.to_hash) %>
        <% end %>
      </div>
      <div id='js-results'>
        <%= render_mustache('results', @results.to_hash) %>
      </div>
    </div>
  </div>
</div>


<script>
  $(document).on("click", ".remove-filter", function(e){
    e.preventDefault();

    var selector = "";
    var name = $(this).data("name");
    if(name.length > 0){
        selector +=  " :input[name='" + name + "']";
    } else {
        var value = $(this).data("value");
        selector += " :input[value='" + value + "']";
    }

    var facet = $(this).data("facet");
    var $elem = $("#" + facet).find(selector);

    var inputType = $elem.prop("type");
    if(inputType == "checkbox"){
        $elem.trigger("click");
    } else {
        $elem.val("").trigger("change");
    }
  });
</script>
