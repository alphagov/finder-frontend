<% if result_set_presenter.user_supplied_keywords.length > 0 %>
  <% content_for :title, "#{result_set_presenter.user_supplied_keywords} - #{content_item.title}" %>
<% else %>
  <% content_for :title, content_item.title %>
<% end %>

<% content_for :head do %>
  <%= render 'finder_meta', content_item: content_item %>
  <meta name="govuk:search-result-count" content="<%= result_set_presenter.total_count %>">
  <% if result_set_presenter.discovery_engine_attribution_token %>
    <meta name="govuk:discovery-engine-attribution-token" content="<%= result_set_presenter.discovery_engine_attribution_token %>">
  <% end %>
<% end %>
<% content_for :meta_title, content_item.title %>

<form method="get" action="<%= content_item.base_path %>" data-ga4-change-category="clear-all-filters">
  <%= hidden_field_tag :parent, @parent if @parent.present? %>

  <div class="govuk-width-container">
    <%= render 'govuk_publishing_components/components/contextual_breadcrumbs', content_item: content_item.as_hash %>
  </div>

  <div class="govuk-width-container">
    <div class="govuk-grid-row">
      <div class="govuk-grid-column-two-thirds">
        <%= render "govuk_publishing_components/components/heading", {
          text: sanitize("Search <span class='govuk-visually-hidden'>all content on</span> GOV.UK"),
          heading_level: 1,
          font_size: "xl",
          margin_bottom: 4,
        } %>

        <div id="keywords" role="search" aria-label="Sitewide" data-ga4-change-category="update-keyword text">
          <%= render "govuk_publishing_components/components/search", {
            id: "finder-keyword-search",
            name: "keywords",
            type: 'search',
            value: result_set_presenter.user_supplied_keywords,
            disable_corrections: true,
          } %>
        </div>

        <div class="spelling-suggestions">
          <%= render 'spelling_suggestion' %>
        </div>

        <%= render "components/filter_panel", {
          button_text: "Filter and sort",
          result_text: result_set_presenter.displayed_total,
        } do %>
          <% facets.each_with_index_and_count do |facet, index, count| %>
            <%=
              render partial: "finders/all_content_finder_facets/#{facet.to_partial_path}",
                object: facet,
                locals: { index:, count: }
            %>
          <% end %>
        <% end %>

        <%= render "components/filter_summary", {
          clear_all_href: @filter_summary_presenter.clear_all_href,
          clear_all_text: "Clear all filters",
          heading_level: 3,
          heading_text: "Selected filters",
          filters: @filter_summary_presenter.items,
        } %>

        <% if result_set_presenter.total_count.positive? %>
          <%= render "govuk_publishing_components/components/document_list", {
            remove_top_border_from_first_child: true,
            disable_ga4: true,
            items: result_set_presenter.search_results_content[:document_list_component_data],
          } %>
        <% else %>
          <div class='no-results govuk-!-font-size-19 govuk-!-margin-top-4'>
            <p class='govuk-body govuk-!-font-weight-bold'>There are no matching results.</p>
            <p class='govuk-body'>Improve your search results by:</p>
            <ul class="govuk-list govuk-list--bullet">
              <li>removing filters</li>
              <li>double-checking your spelling</li>
              <li>using fewer keywords</li>
              <li>searching for something less specific</li>
            </ul>
          </div>
        <% end %>

        <%= render "govuk_publishing_components/components/previous_and_next_navigation", @pagination.next_and_prev_links %>
      </div>
    </div>
  </div>
</div>
